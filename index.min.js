/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2021 Taufik Nurrohman
 *
 * <https://github.com/taufik-nurrohman/text-editor.source>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(((e="undefined"!=typeof globalThis?globalThis:e||self).TE=e.TE||{},e.TE.Source={}))}(this,(function(e){"use strict";var r=function(e){return e&&e.preventDefault()};let t,i={"`":"`","(":")","{":"}","[":"]",'"':'"',"'":"'","<":">"};e.onKeyDown=function(e,t){let o,n,f=t.state.tab||"\t",d=e.key,l=e.altKey,c=e.ctrlKey,u=e.shiftKey;if(l||c)return;if("Enter"===d&&!u){let{after:d,before:l,value:c}=t.$(),u=l.split("\n").pop().match(/^(\s+)/),s=u&&u[1]||"";if(!c){if(d&&l&&(o=i[n=l.slice(-1)])&&o===d[0])return t.wrap("\n"+s+(n!==o?f:""),"\n"+s).record(),void r(e);if(s)return t.insert("\n"+s,-1).record(),void r(e)}}if("Backspace"===d&&!u){let{after:d,before:l,value:c}=t.$();d.split("\n")[0];let u=l.split("\n").pop(),s=u.match(/^(\s+)/),a=s&&s[1]||"";if(o=i[n=l.slice(-1)],"\\"===n)return;if(c&&d&&l&&o&&o===d[0]&&!l.endsWith("\\"+n))return t.record().peel(n,o).record(),void r(e);if(o=i[n=l.trim().slice(-1)],o&&n&&d.startsWith("\n"+a+o)&&l.endsWith(n+"\n"+a))return t.trim("","").record(),void r(e);if(u.endsWith(f))return t.pull(f).record(),void r(e);if(d&&l&&!l.endsWith("\\"+n)&&o===d[0])return t.peel(n,o).record(),void r(e)}let{after:s,before:a,start:p,value:y}=t.$();if(o=i[n=a.slice(-1)],"\\"!==n){if(s&&a&&o&&d===o&&d===s[0])return y?(t.record().wrap(n,o).record(),void r(e)):(t.select(p+1).record(),void r(e));for(n in i){if(o=i[n],n===d)return t.wrap(n,o).record(),void r(e);if(o===d)return y?(t.record().wrap(n,o).record(),void r(e)):void 0}}},e.onKeyDownDent=function(e,t){let i=t.state.tab||"\t",o=e.key,n=e.altKey,f=e.ctrlKey;if(e.shiftKey,!n&&f){if("]"===o)return t.push(i).record(),void r(e);if("["===o)return t.pull(i).record(),void r(e)}},e.onKeyDownHistory=function(e,t){let i=e.key,o=e.altKey,n=e.ctrlKey;if(!o&&n){if("y"===i)return t.redo(),void r(e);if("z"===i)return t.undo(),void r(e)}},e.onKeyDownTab=function(e,t){let i=t.state.tab||"\t",o=e.key,n=e.altKey,f=e.ctrlKey,d=e.shiftKey;if("Tab"===o&&!n&&!f)return t[d?"pull":"push"](i).record(),void r(e)},e.onKeyUp=function(e,r){t&&clearTimeout(t),t=setTimeout((()=>r.record()),100)}}));