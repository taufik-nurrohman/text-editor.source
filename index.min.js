/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2021 Taufik Nurrohman
 *
 * <https://github.com/taufik-nurrohman/text-editor.source>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):((e="undefined"!=typeof globalThis?globalThis:e||self).TE=e.TE||{},e.TE.Source=r())}(this,(function(){"use strict";let e={"`":"`","(":")","{":"}","[":"]",'"':'"',"'":"'","<":">"},r=Object.values(e);let t;return{canKeyDown:function(t,{a:n,c:i,s:o},u){let c,f,s=u.state.tab||"\t";if(n||i)return!0;if("Enter"===t&&!o){let{after:r,before:t,value:n}=u.$(),i=t.split("\n").pop().match(/^(\s+)/),o=i&&i[1]||"";if(!n){if(r&&t&&(c=e[f=t.slice(-1)])&&c===r[0])return u.wrap("\n"+o+(f!==c?s:""),"\n"+o).record(),!1;if(o)return u.insert("\n"+o,-1).record(),!1}}if("Backspace"===t&&!o){let{after:r,before:t,value:n}=u.$();r.split("\n")[0];let i=t.split("\n").pop(),o=i.match(/^(\s+)/),a=o&&o[1]||"";if(c=e[f=t.slice(-1)],"\\"===f)return!0;if(n)return!(r&&t&&c&&c===r[0]&&!t.endsWith("\\"+f))||(u.record().peel(f,c).record(),!1);if(c=e[f=t.trim().slice(-1)],c&&f&&r.startsWith("\n"+a+c)&&t.endsWith(f+"\n"+a))return u.trim("","").record(),!1;if(i.endsWith(s))return u.pull(s).record(),!1;if(r&&t&&!t.endsWith("\\"+f)&&c===r[0])return u.peel(f,c).record(),!1}let{after:a,before:l,start:d,value:p}=u.$();if("\\"===(f=l.slice(-1)))return!0;if(c=r.includes(a[0])?a[0]:e[f],!p&&a&&l&&c&&t===c)return u.select(d+1).record(),!1;for(f in e){if(c=e[f],f===t)return u.wrap(f,c).record(),!1;if(c===t){if(p)return u.record().wrap(f,c).record(),!1;break}}return!0},canKeyDownDent:function(e,{a:r,c:t,s:n},i){let o=i.state.tab||"\t";if(!r&&t){if("]"===e)return i.push(o).record(),!1;if("["===e)return i.pull(o).record(),!1}return!0},canKeyDownHistory:function(e,{a:r,c:t,s:n},i){if(!r&&t){if("y"===e)return i.redo(),!1;if("z"===e)return i.undo(),!1}return!0},canKeyDownTab:function(e,{a:r,c:t,s:n},i){let o=i.state.tab||"\t";return!("Tab"===e&&!r&&!t)||(i[n?"pull":"push"](o).record(),!1)},canKeyUp:function(e,{a:r,c:n,s:i},o){return t&&clearTimeout(t),t=setTimeout((()=>o.record()),100),!0}}}));